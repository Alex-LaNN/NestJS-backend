# Указание базового образа Node.js для этапа сборки
FROM node:20-alpine AS builder

# Установка рабочей директории
WORKDIR /usr/src

# Аргументы, которые будут переданы из docker-compose.test.yml
ARG NODE_ENV
ARG ENV_FILE

# Копирование всех файлов проекта
COPY . .

# # Второй этап: создание финального образа
# FROM node:20-alpine

# # Установка рабочей директории
# WORKDIR /usr/src

# # Копирование всех файлов проекта для тестирования
# COPY --from=builder /usr/src ./

# # Копирование скрипта для тестов и делаем его исполняемым
# COPY run-tests.sh /usr/src/run-tests.sh
# RUN chmod +x /usr/src/run-tests.sh

# # Запуск скрипта тестирования
# CMD ["/usr/src/run-tests.sh"]

RUN echo "1. Просмотр содержимого..."
RUN ls -lart

RUN rm -rf node_modules
RUN npm install
RUN npm run build

RUN echo "2. Просмотр содержимого..."
RUN ls -lart

RUN npm run test -- films.controller.spec.ts